# 第十章

在 Linux 中，一个文件就是一个 m 字节的序列。所有的 IO 设备（例如网络、磁盘和终端）都被模型化为设备。这种把设备都模拟成文件的方式，叫做 Unix IO，所有的 IO 操作都以下面的统一的方式进行

- 打开文件：打开一个文件后，内核返回一个非负整数，叫做**文件描述符**。之后所有对这个文件的操作都会使用文件描述符
- Linux shell 在创建每个进程后，都会为进程创建 3 个文件描述符：标准输入（描述符 0）、标准输出（描述符 1）、标准错误（描述符 2）
- 改变当前的文件位置：对于每个打开的文件，内核保持一个文件位置 k，初始为 0 。文件位置是从文件开头起始的字节偏移量，应用程序使用 `seek` 函数 能显式的改变文件位置
- 读写文件：读文件就是从文件中读取一些字节到内存里，读取了 n 个字节后，k 就会变成 k + n。如果读取文件后 k 的大小超过了文件的大小，那么就会触发一个 end of file （EOF）条件。写操作就是从内存复制 n 个字节到文件中，并更新 k 的值
- 关闭文件：当进程完成了对文件的访问后，需要显式的关闭文件，这样操作系统就能释放为打开文件创建的数据结构等，并将文件描述符释放到可用的描述符池中。无论当进程以什么原因终止时，内核都会释放进程打开的文件描述符

每个 Linux 文件都有一个类型来表示它在系统中的角色

- 普通文件：普通文件包含任意数据，可以分为文本文件（text file）和二进制文件（binary file）。对于内核而言，这两种文件没有任何区别
- 目录（directory）：目录是包含一组链接（link）的文件，其中每个链接都将一个文件名映射到一个文件，这个文件也可能是一个目录
- 套接字（socket）：套接字是用来与另一个进程进行跨网络通信的文件

其他的文件类型还包括命名通道（named pipe）、符号链接（symbolic link）、字符和块设备（character and block device）